# mRemoteNG <= v1.77.3.1784-NB Password Dumper ([CVE-2023-32784](https://nvd.nist.gov/vuln/detail/CVE-2023-30367))

The vulnerability was assigned [CVE-2023-30367](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-30367). A fix is still in development. Thanks again to Dimitrij Gorodeckij for his fast response and cooperation!


### What can you do
First, **update to mRemoteNG greater than v1.77.3.1784-NB when a fix has been released**.


1. Use safe configuration encryption passwords. In case of a memory dump an attacker would gain access to configuration files in plaintext but would still have to bruteforce the passwords encryption key.


mRemoteNG Password Dumper is a simple proof-of-concept tool used to dump configuration files from mremoteNG's memory. No code execution on the target system is required, just a memory dump.

Tested with `mRemoteNG 1.77.3.1784-NB` and `mRemoteNG 1.76.20` on Windows 11 (German). Unfortunately, enabling the `Connection file encryption` option doesn't help in preventing the attack since mRemoteNG connection configuration files get decrypted at runtime.

Finding was confirmed by Dimitrij Gorodeckij, one of mRemoteNG's developers, [here](https://github.com/mRemoteNG/mRemoteNG/issues/2420). I appreciate Dimitrij's fast response. Hopefully it will be fixed soon!

## Setup
1. [Install .NET](https://dotnet.microsoft.com/en-us/download) (most major operating systems supported).
2. Clone the repository: `git clone https://github.com/vdohney/keepass-password-dumper` or download it from GitHub
2. Enter the project directory `mRemoteNG-password-dumper`
3. Open solution with VisualStudio and build using .Net 4.8.1
4. Start mRemoteNG and enter a file decryption password if needed.
5. Execute mRemoteNG_Dumper.exe

The easiest way to manually test this on Windows is to create a process dump in the task manager by right-clicking the mRemoteNG process and selecting "Create dump file".
The dump can be opened in VisualStudio Code. Search then for your configured connection passwords.

![Usage example](assets/anim.gif)


## Should You Be Worried?

Depends on your threat model. **If your computer is already infected by malware that's running in the background with the privileges of your user, this finding doesn't make your situation much worse.** However, it might be easier for the malware to be stealthy and evade the antivirus, since unlike KeeTheft or KeeFarce, no process injection or other type of code execution is necessary. 

If you have a reasonable suspicion that someone could obtain access to your computer and conduct forensic analysis, this could be bad.

If you use configuration file encryption with a strong password and your system is clean, you should be fine. No one can steal your passwords remotely over the internet with this finding alone. 

## How It Works

mRemoteNG configuration files can be stored in an encrypted state on disk. When mRemoteNG is started the encrypted connection files are read from disk and get decrypted in memory. The connection files are then stored as plain text values in memory of the mRemoteNG process, even before a connection is established.

### mRemoteNG_Decrypt.py

I added a hacky bruteforce functionality to mremoteng-decrypt (See acknowledgements).
This can be used to bruteforce custom mRemoteNG configuration/password encryption keys. If no custom key has been configured the script will decrypt the config with default key `mR3m`. With gained keys, this script can also be used to decrypt configuration files with custom passwords. Also see [Demo](#demo-watch-in-new-tab).

![mremoteng_decrypt](/assets/mremoteng_decrypt_and_bruteforce.png)

Decrypt configuration file with custom password 123: `python3 mremoteng_decrypt.py -rf "C:\Users\mbzra\source\repos\mRemoteNG Dumper\dump\extracted_Configfile_mRemoteNG_0_09.07.2023.11.01_confCons.xml" -p 123`

Decrypt password string with custom password 123: `python3 mremoteng_decrypt.py -s "QHrcb7I0KHi6YLFXxv93jenrUmNj5qO30zTM9qXqRUd7ImVm5/ROU7CLQ5u7+7+iOiFrY2BtZSpJ8RrR3jV6LoE=" -p 123`

Decrypt password string with no custom configuration password: `python3 mremoteng_decrypt.py -s "yW0Ypq/cTcwfHwYxIiHgczcsIKU+jWlfnZBcTdKQImsMbBnP3SLv2h75Z7IAbkFOsD2YzBo2wGk2fhDLpRFH2y8="`

Bruteforce usage: `python3 mremoteng_decrypt.py -s "[extracted encrypted configuration password]" -b y -w [path to wordlist]`

Bruteforce example: `python3 mremoteng_decrypt.py -s "QHrcb7I0KHi6YLFXxv93jenrUmNj5qO30zTM9qXqRUd7ImVm5/ROU7CLQ5u7+7+iOiFrY2BtZSpJ8RrR3jV6LoE=" -b y -w .\wordli.txt`

## Dev

It's a quick POC, so likely not very reliable and robust. Please create a pull request if you happen to find an issue and fix it.

Configuration files are currently hardcoded like this: `(\<Node)(.*)(?=\/>)\/>`

## Demo (Watch in new Tab)
![Demo](/assets/mRemoteNGDumper-demo.gif)

## Acknowledgements to related Projects
- [Python mRemoteNG Password decryptor](https://github.com/kmahyyg/mremoteng-decrypt) by [kmahyyg](https://github.com/kmahyyg) which I modified to add bruteforce functionality.
- [Keepass master password dumper](https://github.com/kmahyyg/mremoteng-decrypt) by [vdohney](https://github.com/vdohney) where I stole this README.md from which I adjusted to my needs.
